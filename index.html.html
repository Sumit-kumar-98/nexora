<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ContentFlow CMS Pro - Enhanced Media Upload</title>
    
    <style>
        /* Including original styles from your document - keeping exact same */
        @import url('https://fonts.googleapis.com/css2?family=Archivo:wght@300;400;600;700;900&family=JetBrains+Mono:wght@400;600&display=swap');
        :root {--bg-primary:#0a0a0f;--bg-secondary:#14141f;--bg-tertiary:#1e1e2e;--accent-primary:#00d4ff;--accent-secondary:#7c3aed;--accent-gradient:linear-gradient(135deg,#00d4ff 0%,#7c3aed 100%);--text-primary:#ffffff;--text-secondary:#a0a0b8;--text-muted:#6b6b7f;--success:#10b981;--warning:#f59e0b;--danger:#ef4444;--border-color:#2a2a3e;--shadow-sm:0 2px 8px rgba(0,0,0,0.3);--shadow-md:0 4px 16px rgba(0,0,0,0.4);--shadow-lg:0 8px 32px rgba(0,0,0,0.5);--shadow-glow:0 0 20px rgba(0,212,255,0.3);--transition-fast:0.2s ease;--transition-normal:0.3s ease;--transition-slow:0.5s ease}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Archivo',sans-serif;background:var(--bg-primary);color:var(--text-primary);line-height:1.6;overflow-x:hidden}body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at 20% 50%,rgba(0,212,255,0.08) 0%,transparent 50%),radial-gradient(circle at 80% 80%,rgba(124,58,237,0.08) 0%,transparent 50%);pointer-events:none;z-index:0;animation:backgroundPulse 10s ease-in-out infinite}@keyframes backgroundPulse{0%,100%{opacity:1}50%{opacity:0.6}}.particles{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0}.particle{position:absolute;background:var(--accent-primary);border-radius:50%;opacity:0.1;animation:float 20s infinite}@keyframes float{0%,100%{transform:translateY(0) translateX(0)}25%{transform:translateY(-100px) translateX(50px)}50%{transform:translateY(-50px) translateX(-50px)}75%{transform:translateY(-150px) translateX(100px)}}.container{position:relative;z-index:1}.login-container{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem;position:relative}.login-box{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:20px;padding:3rem;width:100%;max-width:450px;box-shadow:var(--shadow-lg);animation:fadeInUp 0.6s ease;position:relative;overflow:hidden}.login-box::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:conic-gradient(from 0deg,transparent,var(--accent-primary),transparent);animation:rotate 4s linear infinite;opacity:0.1}@keyframes rotate{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.login-box>*{position:relative;z-index:1}@keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}.login-header{text-align:center;margin-bottom:2.5rem}.login-header h1{font-size:2.5rem;font-weight:900;background:var(--accent-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:0.5rem;letter-spacing:-0.02em;animation:gradientShift 3s ease infinite}@keyframes gradientShift{0%,100%{filter:hue-rotate(0deg)}50%{filter:hue-rotate(20deg)}}.login-header p{color:var(--text-secondary);font-size:0.95rem}.form-group{margin-bottom:1.5rem;animation:slideIn 0.4s ease backwards}.form-group:nth-child(1){animation-delay:0.1s}.form-group:nth-child(2){animation-delay:0.2s}@keyframes slideIn{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}.form-group label{display:block;margin-bottom:0.5rem;color:var(--text-secondary);font-size:0.9rem;font-weight:600}.form-control{width:100%;padding:0.875rem 1rem;background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:10px;color:var(--text-primary);font-size:0.95rem;transition:var(--transition-normal);font-family:'Archivo',sans-serif}.form-control:focus{outline:none;border-color:var(--accent-primary);box-shadow:0 0 0 3px rgba(0,212,255,0.1);transform:translateY(-2px)}.btn{padding:0.875rem 1.5rem;border:none;border-radius:10px;font-size:0.95rem;font-weight:600;cursor:pointer;transition:var(--transition-normal);font-family:'Archivo',sans-serif;display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;position:relative;overflow:hidden}.btn::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;border-radius:50%;background:rgba(255,255,255,0.2);transform:translate(-50%,-50%);transition:width 0.6s,height 0.6s}.btn:active::before{width:300px;height:300px}.btn-primary{background:var(--accent-gradient);color:var(--text-primary);width:100%;box-shadow:var(--shadow-md)}.btn-primary:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg),var(--shadow-glow)}.demo-credentials{margin-top:2rem;padding:1.25rem;background:var(--bg-tertiary);border-radius:10px;border-left:3px solid var(--accent-primary);animation:fadeInUp 0.6s ease 0.3s backwards}.demo-credentials h3{font-size:0.85rem;color:var(--text-secondary);margin-bottom:0.75rem;text-transform:uppercase;letter-spacing:0.05em}.demo-credentials p{font-family:'JetBrains Mono',monospace;font-size:0.85rem;color:var(--text-primary);margin:0.25rem 0}.dashboard{display:none;min-height:100vh}.dashboard.active{display:flex;animation:fadeIn 0.4s ease}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.sidebar{width:280px;background:var(--bg-secondary);border-right:1px solid var(--border-color);padding:2rem 0;position:fixed;height:100vh;overflow-y:auto;z-index:100;transition:var(--transition-normal)}.sidebar-brand{padding:0 2rem;margin-bottom:2.5rem}.sidebar-brand h2{font-size:1.75rem;font-weight:900;background:var(--accent-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:-0.02em;animation:pulse 2s ease-in-out infinite}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}.sidebar-menu{list-style:none}.menu-item{margin:0.25rem 0;animation:slideInLeft 0.4s ease backwards}.menu-item:nth-child(1){animation-delay:0.1s}.menu-item:nth-child(2){animation-delay:0.15s}.menu-item:nth-child(3){animation-delay:0.2s}.menu-item:nth-child(4){animation-delay:0.25s}.menu-item:nth-child(5){animation-delay:0.3s}.menu-item:nth-child(6){animation-delay:0.35s}@keyframes slideInLeft{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}.menu-link{display:flex;align-items:center;gap:0.875rem;padding:0.875rem 2rem;color:var(--text-secondary);text-decoration:none;transition:var(--transition-fast);font-weight:500;position:relative}.menu-link::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:3px;height:0;background:var(--accent-gradient);transition:var(--transition-normal)}.menu-link:hover{color:var(--text-primary);background:rgba(0,212,255,0.05);padding-left:2.5rem}.menu-link.active{color:var(--text-primary);background:rgba(0,212,255,0.1)}.menu-link.active::before{height:100%}.menu-icon{font-size:1.25rem;width:24px;text-align:center;animation:bounce 1s ease infinite}.menu-link:hover .menu-icon{animation:spin 0.5s ease}@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-3px)}}@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}.sidebar-footer{padding:0 2rem;margin-top:2rem;padding-top:2rem;border-top:1px solid var(--border-color)}.main-content{margin-left:280px;flex:1;min-height:100vh;transition:var(--transition-normal)}.topbar{background:var(--bg-secondary);border-bottom:1px solid var(--border-color);padding:1.25rem 2rem;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:50;backdrop-filter:blur(10px)}.topbar-left{display:flex;align-items:center;gap:1rem}.topbar-left h1{font-size:1.75rem;font-weight:700;color:var(--text-primary);animation:slideInRight 0.5s ease}@keyframes slideInRight{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}.topbar-right{display:flex;align-items:center;gap:1.5rem}.notification-icon{width:40px;height:40px;border-radius:10px;background:var(--bg-tertiary);border:1px solid var(--border-color);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--transition-normal);position:relative}.notification-icon:hover{background:var(--accent-primary);color:var(--bg-primary);transform:scale(1.1)}.notification-badge{position:absolute;top:-5px;right:-5px;background:var(--danger);color:white;font-size:0.7rem;font-weight:700;padding:2px 6px;border-radius:10px;animation:ping 1s ease infinite}@keyframes ping{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.2);opacity:0.8}}.user-info{display:flex;align-items:center;gap:0.75rem;animation:fadeIn 0.5s ease 0.2s backwards}.user-avatar{width:40px;height:40px;border-radius:50%;background:var(--accent-gradient);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1rem;animation:rotate 3s linear infinite}.user-details{display:flex;flex-direction:column}.user-name{font-weight:600;font-size:0.9rem}.user-role{font-size:0.75rem;color:var(--text-secondary)}.content-area{padding:2rem}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin-bottom:2rem}.stat-card{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:16px;padding:1.75rem;transition:var(--transition-normal);position:relative;overflow:hidden;animation:scaleIn 0.5s ease backwards}.stat-card:nth-child(1){animation-delay:0.1s}.stat-card:nth-child(2){animation-delay:0.2s}.stat-card:nth-child(3){animation-delay:0.3s}.stat-card:nth-child(4){animation-delay:0.4s}@keyframes scaleIn{from{opacity:0;transform:scale(0.9)}to{opacity:1;transform:scale(1)}}.stat-card::before{content:'';position:absolute;top:0;left:0;width:100%;height:3px;background:var(--accent-gradient);transform:scaleX(0);transition:var(--transition-normal)}.stat-card::after{content:'';position:absolute;top:-50%;right:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(0,212,255,0.1) 0%,transparent 70%);transform:scale(0);transition:var(--transition-slow)}.stat-card:hover{transform:translateY(-8px) scale(1.02);box-shadow:var(--shadow-lg),var(--shadow-glow)}.stat-card:hover::before{transform:scaleX(1)}.stat-card:hover::after{transform:scale(1)}.stat-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.stat-title{color:var(--text-secondary);font-size:0.875rem;font-weight:600;text-transform:uppercase;letter-spacing:0.05em}.stat-icon{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;background:rgba(0,212,255,0.1);transition:var(--transition-normal)}.stat-card:hover .stat-icon{transform:rotate(360deg) scale(1.1)}.stat-value{font-size:2.5rem;font-weight:900;color:var(--text-primary);line-height:1;animation:countUp 1s ease}@keyframes countUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.stat-change{font-size:0.875rem;margin-top:0.5rem;display:flex;align-items:center;gap:0.25rem}.stat-change.positive{color:var(--success)}.content-section{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:16px;padding:2rem;margin-bottom:2rem;animation:slideUp 0.6s ease backwards}@keyframes slideUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}.section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.section-title{font-size:1.5rem;font-weight:700}.btn-secondary{background:var(--bg-tertiary);color:var(--text-primary);border:1px solid var(--border-color)}.btn-secondary:hover{background:var(--accent-gradient);border-color:transparent;transform:translateY(-2px)}.content-table{width:100%;border-collapse:collapse}.content-table thead{border-bottom:1px solid var(--border-color)}.content-table th{padding:1rem;text-align:left;font-size:0.875rem;color:var(--text-secondary);font-weight:600;text-transform:uppercase;letter-spacing:0.05em}.content-table td{padding:1.25rem 1rem;border-bottom:1px solid var(--border-color)}.content-table tbody tr{transition:var(--transition-fast);animation:fadeInRow 0.4s ease backwards}.content-table tbody tr:nth-child(1){animation-delay:0.1s}.content-table tbody tr:nth-child(2){animation-delay:0.2s}.content-table tbody tr:nth-child(3){animation-delay:0.3s}.content-table tbody tr:nth-child(4){animation-delay:0.4s}.content-table tbody tr:nth-child(5){animation-delay:0.5s}@keyframes fadeInRow{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}.content-table tbody tr:hover{background:rgba(0,212,255,0.05);transform:translateX(5px)}.status-badge{display:inline-block;padding:0.375rem 0.875rem;border-radius:20px;font-size:0.75rem;font-weight:600;text-transform:uppercase;letter-spacing:0.05em;animation:fadeIn 0.5s ease}.status-published{background:rgba(16,185,129,0.15);color:var(--success)}.status-draft{background:rgba(245,158,11,0.15);color:var(--warning)}.action-buttons{display:flex;gap:0.5rem}.btn-icon{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:var(--bg-tertiary);border:1px solid var(--border-color);color:var(--text-secondary);cursor:pointer;transition:var(--transition-fast)}.btn-icon:hover{background:var(--accent-primary);color:var(--bg-primary);border-color:var(--accent-primary);transform:scale(1.1) rotate(5deg)}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center;animation:fadeIn 0.3s ease;backdrop-filter:blur(5px)}.modal.active{display:flex}.modal-content{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:20px;padding:2.5rem;width:90%;max-width:600px;max-height:90vh;overflow-y:auto;animation:modalSlideUp 0.4s ease;box-shadow:var(--shadow-lg),var(--shadow-glow)}@keyframes modalSlideUp{from{opacity:0;transform:translateY(50px) scale(0.9)}to{opacity:1;transform:translateY(0) scale(1)}}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}.modal-title{font-size:1.75rem;font-weight:700}.close-modal{width:36px;height:36px;border-radius:8px;background:var(--bg-tertiary);border:1px solid var(--border-color);color:var(--text-secondary);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.25rem;transition:var(--transition-fast)}.close-modal:hover{background:var(--danger);color:var(--text-primary);border-color:var(--danger);transform:rotate(90deg)}.form-row{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}.form-actions{display:flex;gap:1rem;margin-top:2rem}.btn-success{background:var(--success);color:var(--text-primary)}.btn-success:hover{transform:translateY(-2px);box-shadow:var(--shadow-md)}textarea.form-control{min-height:150px;resize:vertical;font-family:'JetBrains Mono',monospace;font-size:0.875rem}.alert{padding:1rem 1.25rem;border-radius:10px;margin-bottom:1.5rem;display:flex;align-items:center;gap:0.75rem;animation:slideDown 0.4s ease}@keyframes slideDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.alert-success{background:rgba(16,185,129,0.15);border:1px solid var(--success);color:var(--success)}.alert-error{background:rgba(239,68,68,0.15);border:1px solid var(--danger);color:var(--danger)}.quick-actions{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:2rem}.quick-action-card{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:12px;padding:1.5rem;text-align:center;cursor:pointer;transition:var(--transition-normal);position:relative;overflow:hidden}.quick-action-card::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;background:radial-gradient(circle,rgba(0,212,255,0.2) 0%,transparent 70%);transform:translate(-50%,-50%);transition:width 0.5s,height 0.5s}.quick-action-card:hover::before{width:300px;height:300px}.quick-action-card:hover{transform:translateY(-8px) scale(1.05);border-color:var(--accent-primary);box-shadow:var(--shadow-md),var(--shadow-glow)}.quick-action-icon{font-size:2rem;margin-bottom:0.75rem;animation:bounce 2s ease infinite}.quick-action-title{font-weight:600;color:var(--text-primary)}.progress-bar{width:100%;height:8px;background:var(--bg-tertiary);border-radius:10px;overflow:hidden;margin:1rem 0}.progress-fill{height:100%;background:var(--accent-gradient);transition:width 0.5s ease;animation:shimmer 2s infinite}@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}.charts-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5rem;margin-bottom:2rem}.chart-card{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:16px;padding:1.75rem;animation:scaleIn 0.5s ease backwards}.chart-header{margin-bottom:1.5rem}.chart-title{font-size:1.2rem;font-weight:700;color:var(--text-primary)}.analytics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;margin-top:1.5rem}.analytics-item{background:var(--bg-tertiary);padding:1rem;border-radius:10px;border:1px solid var(--border-color);transition:var(--transition-normal)}.analytics-item:hover{border-color:var(--accent-primary);transform:translateY(-3px)}.analytics-label{font-size:0.85rem;color:var(--text-secondary);margin-bottom:0.5rem}.analytics-value{font-size:1.5rem;font-weight:700;color:var(--text-primary)}.activity-timeline{padding:1rem 0}.timeline-item{display:flex;gap:1rem;margin-bottom:1.5rem;animation:fadeInRow 0.5s ease backwards}.timeline-dot{width:12px;height:12px;background:var(--accent-primary);border-radius:50%;margin-top:0.5rem;flex-shrink:0;animation:pulse 2s ease infinite}.timeline-content{flex:1}.timeline-title{font-weight:600;color:var(--text-primary);margin-bottom:0.25rem}.timeline-desc{font-size:0.875rem;color:var(--text-secondary)}.timeline-time{font-size:0.75rem;color:var(--text-muted);margin-top:0.25rem}.search-bar{position:relative;max-width:400px}.search-input{width:100%;padding:0.75rem 1rem 0.75rem 3rem;background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:10px;color:var(--text-primary);font-size:0.9rem;transition:var(--transition-normal)}.search-input:focus{outline:none;border-color:var(--accent-primary);box-shadow:0 0 0 3px rgba(0,212,255,0.1)}.search-icon{position:absolute;left:1rem;top:50%;transform:translateY(-50%);color:var(--text-secondary)}.loading{text-align:center;padding:3rem;color:var(--text-secondary)}.spinner{width:50px;height:50px;margin:0 auto 1rem;border:3px solid var(--border-color);border-top-color:var(--accent-primary);border-radius:50%;animation:spin 0.8s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}

        /* ==================== ENHANCED MEDIA STYLES ==================== */
        .file-upload-zone{border:2px dashed var(--border-color);border-radius:12px;padding:2rem;text-align:center;background:var(--bg-tertiary);transition:var(--transition-normal);cursor:pointer;margin-bottom:2rem}.file-upload-zone:hover{border-color:var(--accent-primary);background:rgba(0,212,255,0.05)}.file-upload-zone.dragover{border-color:var(--accent-primary);background:rgba(0,212,255,0.1);transform:scale(1.02)}.upload-icon{font-size:3rem;margin-bottom:1rem;opacity:0.5}.upload-text{color:var(--text-secondary);margin-bottom:1rem}.file-input-hidden{display:none}.media-type-tabs{display:flex;gap:1rem;margin-bottom:1.5rem;border-bottom:1px solid var(--border-color)}.media-type-tab{padding:0.75rem 1.5rem;background:transparent;border:none;color:var(--text-secondary);cursor:pointer;font-weight:600;border-bottom:2px solid transparent;transition:var(--transition-fast)}.media-type-tab:hover{color:var(--text-primary)}.media-type-tab.active{color:var(--accent-primary);border-bottom-color:var(--accent-primary)}.media-card{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:16px;overflow:hidden;transition:var(--transition-normal);position:relative}.media-card:hover{transform:translateY(-8px);box-shadow:var(--shadow-lg),var(--shadow-glow)}.media-thumbnail{width:100%;height:200px;background:var(--bg-tertiary);display:flex;align-items:center;justify-content:center;font-size:4rem;position:relative;overflow:hidden}.media-thumbnail img,.media-thumbnail video{width:100%;height:100%;object-fit:cover}.media-info{padding:1.25rem}.media-name{font-weight:700;color:var(--text-primary);margin-bottom:0.5rem;font-size:1rem}.media-meta{display:flex;justify-content:space-between;color:var(--text-secondary);font-size:0.8rem;margin-bottom:0.75rem}.media-description{color:var(--text-secondary);font-size:0.875rem;margin-bottom:1rem}.media-actions{display:flex;gap:0.5rem;justify-content:space-between}.btn-view{background:var(--accent-gradient);color:white;padding:0.5rem 1rem;border-radius:8px;border:none;cursor:pointer;font-weight:600;transition:var(--transition-fast);flex:1}.btn-view:hover{transform:translateY(-2px);box-shadow:var(--shadow-md)}.btn-delete{background:var(--danger);color:white;padding:0.5rem 1rem;border-radius:8px;border:none;cursor:pointer;font-weight:600;transition:var(--transition-fast)}.btn-delete:hover{transform:translateY(-2px);box-shadow:var(--shadow-md)}.preview-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:2000;align-items:center;justify-content:center;animation:fadeIn 0.3s ease}.preview-modal.active{display:flex}.preview-content{max-width:90%;max-height:90%;position:relative}.preview-content img,.preview-content video{max-width:100%;max-height:90vh;border-radius:12px}.preview-content iframe{width:80vw;height:90vh;border:none;border-radius:12px;background:white}.preview-close{position:absolute;top:-50px;right:0;width:40px;height:40px;background:var(--danger);color:white;border:none;border-radius:50%;font-size:1.5rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--transition-fast)}.preview-close:hover{transform:rotate(90deg) scale(1.1)}.file-preview{margin-top:1.5rem;padding:1rem;background:var(--bg-tertiary);border-radius:10px;border:1px solid var(--border-color)}.preview-image,.preview-video{max-width:100%;max-height:300px;border-radius:8px;margin-top:1rem}.preview-file-info{display:flex;align-items:center;gap:1rem;margin-top:1rem}.preview-file-icon{font-size:3rem}.preview-file-details{flex:1}.preview-file-name{font-weight:600;color:var(--text-primary);margin-bottom:0.25rem}.preview-file-size{color:var(--text-secondary);font-size:0.875rem}

        ::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:var(--bg-primary)}::-webkit-scrollbar-thumb{background:var(--border-color);border-radius:4px}::-webkit-scrollbar-thumb:hover{background:var(--accent-primary)}@media(max-width:1024px){.sidebar{transform:translateX(-100%)}.sidebar.mobile-active{transform:translateX(0)}.main-content{margin-left:0}.stats-grid{grid-template-columns:repeat(2,1fr)}}@media(max-width:768px){.login-box{padding:2rem}.topbar{padding:1rem}.content-area{padding:1rem}.stats-grid{grid-template-columns:1fr}.content-section{padding:1.25rem}.content-table{font-size:0.875rem}.content-table th,.content-table td{padding:0.75rem 0.5rem}.modal-content{padding:1.5rem;width:95%}.form-row{grid-template-columns:1fr}.topbar-left h1{font-size:1.25rem}.user-details{display:none}}@media(max-width:480px){.section-header{flex-direction:column;gap:1rem;align-items:flex-start}.action-buttons{flex-wrap:wrap}}.menu-toggle{display:none;width:40px;height:40px;border-radius:8px;background:var(--bg-tertiary);border:1px solid var(--border-color);color:var(--text-primary);cursor:pointer;align-items:center;justify-content:center;font-size:1.25rem}@media(max-width:1024px){.menu-toggle{display:flex}}.toast{position:fixed;bottom:2rem;right:2rem;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:10px;padding:1rem 1.5rem;box-shadow:var(--shadow-lg);display:flex;align-items:center;gap:0.75rem;animation:slideInRight 0.4s ease;z-index:2000}@keyframes slideInRight{from{opacity:0;transform:translateX(100px)}to{opacity:1;transform:translateX(0)}}.toast.success{border-left:3px solid var(--success)}.toast.error{border-left:3px solid var(--danger)}.tags-container{display:flex;flex-wrap:wrap;gap:0.5rem;padding:0.5rem;background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:10px;min-height:50px}.tag{display:inline-flex;align-items:center;gap:0.5rem;padding:0.375rem 0.75rem;background:var(--accent-gradient);color:white;border-radius:20px;font-size:0.85rem;animation:scaleIn 0.3s ease}.tag-remove{cursor:pointer;font-weight:700}.tag-remove:hover{transform:scale(1.2)}
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>

    <!-- LOGIN PAGE (Same as Original) -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="login-header">
                <h1>ContentFlow</h1>
                <p>Advanced Enterprise Content Management System</p>
            </div>
            <div id="loginAlert"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" class="form-control" placeholder="Enter username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Enter password" required>
                </div>
                <button type="submit" class="btn btn-primary">
                    <span>üöÄ</span> Sign In
                </button>
            </form>
            <div class="demo-credentials">
                <h3>Demo Credentials</h3>
                <p><strong>Admin:</strong> admin / admin123</p>
                <p><strong>Editor:</strong> editor / editor123</p>
                <p><strong>Author:</strong> author / author123</p>
            </div>
        </div>
    </div>

    <!-- DASHBOARD (Same Structure, Only Media Section Enhanced) -->
    <div id="dashboard" class="dashboard">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-brand"><h2>ContentFlow</h2></div>
            <ul class="sidebar-menu">
                <li class="menu-item"><a href="#" class="menu-link active" data-page="dashboard"><span class="menu-icon">üìä</span><span>Dashboard</span></a></li>
                <li class="menu-item"><a href="#" class="menu-link" data-page="analytics"><span class="menu-icon">üìà</span><span>Analytics</span></a></li>
                <li class="menu-item"><a href="#" class="menu-link" data-page="pages"><span class="menu-icon">üìÑ</span><span>Pages</span></a></li>
                <li class="menu-item"><a href="#" class="menu-link" data-page="posts"><span class="menu-icon">üìù</span><span>Posts</span></a></li>
                <li class="menu-item"><a href="#" class="menu-link" data-page="media"><span class="menu-icon">üñºÔ∏è</span><span>Media Library</span></a></li>
                <li class="menu-item"><a href="#" class="menu-link" data-page="users" id="usersMenuItem"><span class="menu-icon">üë•</span><span>Users</span></a></li>
                <li class="menu-item"><a href="#" class="menu-link" data-page="settings"><span class="menu-icon">‚öôÔ∏è</span><span>Settings</span></a></li>
            </ul>
            <div class="sidebar-footer">
                <button class="btn btn-secondary" id="logoutBtn" style="width:100%"><span>üö™</span> Logout</button>
            </div>
        </aside>

        <main class="main-content">
            <div class="topbar">
                <div class="topbar-left">
                    <button class="menu-toggle" id="menuToggle">‚ò∞</button>
                    <h1 id="pageTitle">Dashboard</h1>
                </div>
                <div class="topbar-right">
                    <div class="notification-icon">üîî<span class="notification-badge">3</span></div>
                    <div class="user-info">
                        <div class="user-avatar" id="userAvatar">A</div>
                        <div class="user-details">
                            <div class="user-name" id="userName">Admin User</div>
                            <div class="user-role" id="userRole">Administrator</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-area" id="contentArea">
                <!-- Dashboard View (keeping original) -->
                <div id="dashboardView">
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-header"><span class="stat-title">Total Pages</span><div class="stat-icon">üìÑ</div></div><div class="stat-value" id="totalPages">0</div><div class="stat-change positive"><span>‚Üó</span> +12% from last month</div></div>
                        <div class="stat-card"><div class="stat-header"><span class="stat-title">Total Posts</span><div class="stat-icon">üìù</div></div><div class="stat-value" id="totalPosts">0</div><div class="stat-change positive"><span>‚Üó</span> +8% from last month</div></div>
                        <div class="stat-card"><div class="stat-header"><span class="stat-title">Media Files</span><div class="stat-icon">üñºÔ∏è</div></div><div class="stat-value" id="totalMedia">0</div><div class="stat-change positive"><span>‚Üó</span> +23% from last month</div></div>
                        <div class="stat-card"><div class="stat-header"><span class="stat-title">Active Users</span><div class="stat-icon">üë•</div></div><div class="stat-value" id="totalUsers">0</div><div class="stat-change positive"><span>‚Üó</span> +5% from last month</div></div>
                    </div>
                    <div class="quick-actions">
                        <div class="quick-action-card" onclick="openNewPageModal()"><div class="quick-action-icon">‚ûï</div><div class="quick-action-title">New Page</div></div>
                        <div class="quick-action-card" onclick="openNewPostModal()"><div class="quick-action-icon">‚úçÔ∏è</div><div class="quick-action-title">New Post</div></div>
                        <div class="quick-action-card" onclick="openMediaModal()"><div class="quick-action-icon">üì§</div><div class="quick-action-title">Upload Media</div></div>
                        <div class="quick-action-card" onclick="switchToPage('analytics')"><div class="quick-action-icon">üìä</div><div class="quick-action-title">View Analytics</div></div>
                    </div>
                    <div class="content-section">
                        <div class="section-header"><h2 class="section-title">Recent Content</h2></div>
                        <table class="content-table">
                            <thead><tr><th>Title</th><th>Type</th><th>Author</th><th>Status</th><th>Date</th></tr></thead>
                            <tbody id="recentContentTable"><tr><td colspan="5" class="loading">Loading...</td></tr></tbody>
                        </table>
                    </div>
                    <div class="content-section">
                        <div class="section-header"><h2 class="section-title">Recent Activity</h2></div>
                        <div class="activity-timeline" id="activityTimeline"></div>
                    </div>
                </div>

                <!-- Analytics View (keeping original) -->
                <div id="analyticsView" style="display:none">
                    <div class="content-section">
                        <h2 class="section-title">Analytics Overview</h2>
                        <div class="analytics-grid">
                            <div class="analytics-item"><div class="analytics-label">Total Views</div><div class="analytics-value">45,678</div></div>
                            <div class="analytics-item"><div class="analytics-label">Unique Visitors</div><div class="analytics-value">12,345</div></div>
                            <div class="analytics-item"><div class="analytics-label">Bounce Rate</div><div class="analytics-value">32.5%</div></div>
                            <div class="analytics-item"><div class="analytics-label">Avg. Time</div><div class="analytics-value">4m 23s</div></div>
                        </div>
                        <div class="progress-bar" style="margin-top:2rem"><div class="progress-fill" style="width:75%"></div></div>
                        <p style="text-align:center;color:var(--text-secondary);margin-top:0.5rem">Monthly Goal: 75% Achieved</p>
                    </div>
                </div>

                <!-- Pages View (keeping original) -->
                <div id="pagesView" style="display:none">
                    <div class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">All Pages</h2>
                            <button class="btn btn-primary" onclick="openNewPageModal()"><span>‚ûï</span> New Page</button>
                        </div>
                        <table class="content-table">
                            <thead><tr><th>Title</th><th>Author</th><th>Status</th><th>Last Modified</th><th>Actions</th></tr></thead>
                            <tbody id="pagesTable"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Posts View (keeping original) -->
                <div id="postsView" style="display:none">
                    <div class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">All Posts</h2>
                            <button class="btn btn-primary" onclick="openNewPostModal()"><span>‚ûï</span> New Post</button>
                        </div>
                        <table class="content-table">
                            <thead><tr><th>Title</th><th>Author</th><th>Category</th><th>Status</th><th>Date</th><th>Actions</th></tr></thead>
                            <tbody id="postsTable"></tbody>
                        </table>
                    </div>
                </div>

                <!-- ENHANCED MEDIA VIEW -->
                <div id="mediaView" style="display:none">
                    <div class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">Media Library</h2>
                            <button class="btn btn-primary" onclick="openMediaModal()"><span>üì§</span> Upload Media</button>
                        </div>
                        <div class="media-type-tabs">
                            <button class="media-type-tab active" onclick="filterMediaByType('all',event)">All Media</button>
                            <button class="media-type-tab" onclick="filterMediaByType('Image',event)">Images</button>
                            <button class="media-type-tab" onclick="filterMediaByType('Video',event)">Videos</button>
                            <button class="media-type-tab" onclick="filterMediaByType('Document',event)">Documents</button>
                        </div>
                        <div id="mediaGrid" class="stats-grid"></div>
                    </div>
                </div>

                <!-- Users View (keeping original) -->
                <div id="usersView" style="display:none">
                    <div class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">User Management</h2>
                            <button class="btn btn-primary" onclick="openNewUserModal()"><span>‚ûï</span> Add User</button>
                        </div>
                        <table class="content-table">
                            <thead><tr><th>Name</th><th>Email</th><th>Role</th><th>Status</th><th>Joined</th><th>Actions</th></tr></thead>
                            <tbody id="usersTable"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Settings View (keeping original) -->
                <div id="settingsView" style="display:none">
                    <div class="content-section">
                        <h2 class="section-title">Site Settings</h2>
                        <form id="settingsForm" style="margin-top:2rem">
                            <div class="form-group"><label>Site Name</label><input type="text" class="form-control" value="ContentFlow CMS"></div>
                            <div class="form-group"><label>Site Description</label><textarea class="form-control">Advanced Content Management System for Enterprise</textarea></div>
                            <div class="form-row">
                                <div class="form-group"><label>Admin Email</label><input type="email" class="form-control" value="admin@contentflow.com"></div>
                                <div class="form-group"><label>Timezone</label><input type="text" class="form-control" value="UTC +5:30"></div>
                            </div>
                            <button type="submit" class="btn btn-success"><span>üíæ</span> Save Settings</button>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Page Modal (keeping original) -->
    <div id="pageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="pageModalTitle">New Page</h2>
                <button class="close-modal" onclick="closeModal('pageModal')">‚úï</button>
            </div>
            <form id="pageForm">
                <div class="form-group"><label>Page Title</label><input type="text" id="pageTitleInput" class="form-control" placeholder="Enter page title" required></div>
                <div class="form-group"><label>Page Content</label><textarea id="pageContent" class="form-control" placeholder="Write your content here..." required></textarea></div>
                <div class="form-row">
                    <div class="form-group"><label>Status</label><select id="pageStatus" class="form-control"><option value="draft">Draft</option><option value="published">Published</option></select></div>
                    <div class="form-group"><label>Author</label><input type="text" id="pageAuthor" class="form-control" readonly></div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success"><span>üíæ</span> Save Page</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('pageModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Post Modal (keeping original) -->
    <div id="postModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="postModalTitle">New Post</h2>
                <button class="close-modal" onclick="closeModal('postModal')">‚úï</button>
            </div>
            <form id="postForm">
                <div class="form-group"><label>Post Title</label><input type="text" id="postTitle" class="form-control" placeholder="Enter post title" required></div>
                <div class="form-group"><label>Post Content</label><textarea id="postContent" class="form-control" placeholder="Write your post content..." required></textarea></div>
                <div class="form-row">
                    <div class="form-group"><label>Category</label><select id="postCategory" class="form-control"><option value="Technology">Technology</option><option value="Business">Business</option><option value="Design">Design</option><option value="Development">Development</option></select></div>
                    <div class="form-group"><label>Status</label><select id="postStatus" class="form-control"><option value="draft">Draft</option><option value="published">Published</option></select></div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success"><span>üíæ</span> Save Post</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('postModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ENHANCED MEDIA UPLOAD MODAL -->
    <div id="mediaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Upload Media</h2>
                <button class="close-modal" onclick="closeModal('mediaModal')">‚úï</button>
            </div>
            <form id="mediaForm">
                <div class="form-group">
                    <label>Media Type</label>
                    <select id="mediaType" class="form-control" onchange="updateFileInputAccept()">
                        <option value="Image">Image</option>
                        <option value="Video">Video</option>
                        <option value="Document">Document</option>
                    </select>
                </div>
                <div class="file-upload-zone" id="fileUploadZone" onclick="document.getElementById('mediaFileInput').click()">
                    <div class="upload-icon" id="uploadIcon">üñºÔ∏è</div>
                    <div class="upload-text"><strong>Click to browse</strong> or drag and drop files here</div>
                    <p style="color:var(--text-muted);font-size:0.875rem;margin-top:0.5rem">Max file size: 50MB</p>
                </div>
                <input type="file" id="mediaFileInput" class="file-input-hidden" accept="image/*" onchange="handleFileSelect(event)">
                <div id="filePreview" class="file-preview" style="display:none"></div>
                <div class="form-group">
                    <label>File Name (Optional)</label>
                    <input type="text" id="mediaName" class="form-control" placeholder="Enter custom file name (optional)">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="mediaDescription" class="form-control" placeholder="Add a description for this media file"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success" id="uploadButton" disabled><span>üì§</span> Upload</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('mediaModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- PREVIEW MODAL -->
    <div id="previewModal" class="preview-modal">
        <div class="preview-content">
            <button class="preview-close" onclick="closePreviewModal()">‚úï</button>
            <div id="previewContainer"></div>
        </div>
    </div>

    <!-- User Modal (keeping original) -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New User</h2>
                <button class="close-modal" onclick="closeModal('userModal')">‚úï</button>
            </div>
            <form id="userForm">
                <div class="form-row">
                    <div class="form-group"><label>Full Name</label><input type="text" id="newUserName" class="form-control" placeholder="Enter full name" required></div>
                    <div class="form-group"><label>Email</label><input type="email" id="newUserEmail" class="form-control" placeholder="Enter email" required></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Role</label><select id="newUserRole" class="form-control"><option value="Author">Author</option><option value="Editor">Editor</option><option value="Administrator">Administrator</option></select></div>
                    <div class="form-group"><label>Status</label><select id="newUserStatus" class="form-control"><option value="Active">Active</option><option value="Inactive">Inactive</option></select></div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success"><span>‚ûï</span> Add User</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('userModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK (Compat Version for Vanilla JS) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics-compat.js"></script>

    <script>
        // Firebase Configuration (New Database)
        const firebaseConfig = {
            apiKey: "AIzaSyDHihH8JeG1eDx3L5Xt2XJknU09T2NfYSE",
            authDomain: "sumit-a16f5.firebaseapp.com",
            projectId: "sumit-a16f5",
            storageBucket: "sumit-a16f5.firebasestorage.app",
            messagingSenderId: "157181252278",
            appId: "1:157181252278:web:7bb676634f52f35e088c17",
            measurementId: "G-TFRBH1QSRS"
        };

        // Initialize Firebase (Compat version)
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const analytics = firebase.analytics();

        // Firebase Helper Functions
        async function saveToFirebase(collection, docId, data) {
            try {
                await db.collection(collection).doc(docId).set(data, { merge: true });
                console.log("Saved to Firebase:", collection, docId);
                return true;
            } catch (error) {
                console.error("Firebase Save Error:", error);
                showToast('Database error: ' + error.message, 'error');
                return false;
            }
        }

        async function getFromFirebase(collection, docId) {
            try {
                const doc = await db.collection(collection).doc(docId).get();
                return doc.exists ? doc.data() : null;
            } catch (error) {
                console.error("Firebase Get Error:", error);
                return null;
            }
        }

        async function deleteFromFirebase(collection, docId) {
            try {
                await db.collection(collection).doc(docId).delete();
                console.log("Deleted from Firebase:", collection, docId);
                return true;
            } catch (error) {
                console.error("Firebase Delete Error:", error);
                showToast('Delete error: ' + error.message, 'error');
                return false;
            }
        }

        async function getAllFromFirebase(collection) {
            try {
                const snapshot = await db.collection(collection).get();
                return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            } catch (error) {
                console.log(`Firebase Get All (${collection}) skipped:`, error.message);
                return null; // Return null instead of empty array to use local data
            }
        }

        // Particles Animation
        function createParticles(){const p=document.getElementById('particles');for(let i=0;i<15;i++){const d=document.createElement('div');d.className='particle';d.style.width=Math.random()*4+2+'px';d.style.height=d.style.width;d.style.left=Math.random()*100+'%';d.style.top=Math.random()*100+'%';d.style.animationDelay=Math.random()*20+'s';d.style.animationDuration=(Math.random()*10+15)+'s';p.appendChild(d)}}
        createParticles();

        // Data Storage (Same as Original)
        let currentUser=null,pages=[],posts=[],media=[],users=[{id:1,username:'admin',password:'admin123',name:'Admin User',email:'admin@cms.com',role:'Administrator',status:'Active',joined:'2024-01-15'},{id:2,username:'editor',password:'editor123',name:'Editor User',email:'editor@cms.com',role:'Editor',status:'Active',joined:'2024-02-20'},{id:3,username:'author',password:'author123',name:'Author User',email:'author@cms.com',role:'Author',status:'Active',joined:'2024-03-10'}],currentMediaFilter='all',selectedFile=null;

        function initializeSampleData(){
            // Load from local storage first
            loadFromLocalStorage();
            
            // Try to sync with Firebase in background (optional)
            loadFirebaseData();
        }

        function loadFromLocalStorage() {
            const savedPages = localStorage.getItem('cms_pages');
            const savedPosts = localStorage.getItem('cms_posts');
            const savedMedia = localStorage.getItem('cms_media');
            const savedUsers = localStorage.getItem('cms_users');
            
            pages = savedPages ? JSON.parse(savedPages) : [{id:1,title:'Home Page',content:'Welcome!',author:'Admin User',status:'published',date:'2024-01-20'},{id:2,title:'About Us',content:'Learn more...',author:'Editor User',status:'published',date:'2024-01-22'},{id:3,title:'Contact Page',content:'Get in touch...',author:'Admin User',status:'draft',date:'2024-01-25'}];
            posts = savedPosts ? JSON.parse(savedPosts) : [{id:1,title:'Getting Started with CMS',content:'Learn how...',author:'Admin User',category:'Technology',status:'published',date:'2024-01-18'},{id:2,title:'Best Practices',content:'Tips...',author:'Editor User',category:'Business',status:'published',date:'2024-01-21'},{id:3,title:'New Features Coming',content:'Exciting updates...',author:'Author User',category:'Development',status:'draft',date:'2024-01-24'}];
            media = savedMedia ? JSON.parse(savedMedia) : [{id:1,name:'hero-banner.jpg',type:'Image',size:'2.4 MB',date:'2024-01-15',description:'Homepage hero banner',dataUrl:'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="400" height="300"%3E%3Crect fill="%2300d4ff" width="400" height="300"/%3E%3Ctext x="50%25" y="50%25" dominant-baseline="middle" text-anchor="middle" font-family="Arial" font-size="24" fill="white"%3EHero Banner%3C/text%3E%3C/svg%3E'},{id:2,name:'product-demo.mp4',type:'Video',size:'15.8 MB',date:'2024-01-18',description:'Product demo',dataUrl:''},{id:3,name:'user-guide.pdf',type:'Document',size:'1.2 MB',date:'2024-01-20',description:'User guide',dataUrl:''}];
            users = savedUsers ? JSON.parse(savedUsers) : [{id:1,username:'admin',password:'admin123',name:'Admin User',email:'admin@cms.com',role:'Administrator',status:'Active',joined:'2024-01-15'},{id:2,username:'editor',password:'editor123',name:'Editor User',email:'editor@cms.com',role:'Editor',status:'Active',joined:'2024-02-20'},{id:3,username:'author',password:'author123',name:'Author User',email:'author@cms.com',role:'Author',status:'Active',joined:'2024-03-10'}];
            
            console.log("Data loaded from local storage");
        }

        function saveToLocalStorage() {
            localStorage.setItem('cms_pages', JSON.stringify(pages));
            localStorage.setItem('cms_posts', JSON.stringify(posts));
            localStorage.setItem('cms_media', JSON.stringify(media));
            localStorage.setItem('cms_users', JSON.stringify(users));
            console.log("Data saved to local storage");
        }

        // Authentication
        document.getElementById('loginForm').addEventListener('submit',function(e){
            e.preventDefault();
            const u=users.find(x=>x.username===document.getElementById('username').value&&x.password===document.getElementById('password').value);
            if(u){
                currentUser=u;
                showAlert('loginAlert','Login successful!','success');
                setTimeout(()=>{
                    document.getElementById('loginPage').style.display='none';
                    document.getElementById('dashboard').classList.add('active');
                    updateUserInfo();
                    loadDashboard();
                    showToast('Welcome back, '+u.name+'!','success');
                },1000);
            }else{
                showAlert('loginAlert','Invalid credentials!','error');
            }
        });

        function updateUserInfo(){
            if(currentUser){
                document.getElementById('userName').textContent=currentUser.name;
                document.getElementById('userRole').textContent=currentUser.role;
                document.getElementById('userAvatar').textContent=currentUser.name.charAt(0).toUpperCase();
                document.getElementById('pageAuthor').value=currentUser.name;
                if(currentUser.role!=='Administrator'){
                    document.getElementById('usersMenuItem').style.display='none';
                }
            }
        }

        // Navigation
        document.querySelectorAll('.menu-link').forEach(l=>l.addEventListener('click',function(e){
            e.preventDefault();
            switchToPage(this.dataset.page);
        }));

        function switchToPage(page){
            document.querySelectorAll('.menu-link').forEach(l=>l.classList.remove('active'));
            document.querySelector(`[data-page="${page}"]`).classList.add('active');
            document.querySelectorAll('#contentArea>div').forEach(v=>v.style.display='none');
            const viewMap={'dashboard':'dashboardView','analytics':'analyticsView','pages':'pagesView','posts':'postsView','media':'mediaView','users':'usersView','settings':'settingsView'};
            document.getElementById(viewMap[page]).style.display='block';
            const titleMap={'dashboard':'Dashboard','analytics':'Analytics','pages':'Pages','posts':'Posts','media':'Media Library','users':'User Management','settings':'Settings'};
            document.getElementById('pageTitle').textContent=titleMap[page];
            if(page==='dashboard')loadDashboard();
            if(page==='pages')loadPages();
            if(page==='posts')loadPosts();
            if(page==='media')loadMedia();
            if(page==='users')loadUsers();
        }

        function loadDashboard(){
            initializeSampleData();
            document.getElementById('totalPages').textContent=pages.length;
            document.getElementById('totalPosts').textContent=posts.length;
            document.getElementById('totalMedia').textContent=media.length;
            document.getElementById('totalUsers').textContent=users.length;
            const recent=[...pages,...posts].sort((a,b)=>new Date(b.date)-new Date(a.date)).slice(0,5);
            document.getElementById('recentContentTable').innerHTML=recent.map(i=>`<tr><td>${i.title}</td><td>${i.category?'Post':'Page'}</td><td>${i.author}</td><td><span class="status-badge status-${i.status}">${i.status}</span></td><td>${i.date}</td></tr>`).join('');
            document.getElementById('activityTimeline').innerHTML=[{title:'New page created',desc:'Homepage redesign',time:'2h ago'},{title:'Post published',desc:'CMS features blog',time:'5h ago'},{title:'Media uploaded',desc:'3 new images',time:'1d ago'}].map(a=>`<div class="timeline-item"><div class="timeline-dot"></div><div class="timeline-content"><div class="timeline-title">${a.title}</div><div class="timeline-desc">${a.desc}</div><div class="timeline-time">${a.time}</div></div></div>`).join('');
        }

        function loadPages(){
            document.getElementById('pagesTable').innerHTML=pages.map(p=>`<tr><td>${p.title}</td><td>${p.author}</td><td><span class="status-badge status-${p.status}">${p.status}</span></td><td>${p.date}</td><td><div class="action-buttons"><button class="btn-icon" onclick="editPage(${p.id})">‚úèÔ∏è</button><button class="btn-icon" onclick="deletePage(${p.id})">üóëÔ∏è</button></div></td></tr>`).join('');
        }

        function openNewPageModal(){
            document.getElementById('pageModalTitle').textContent='New Page';
            document.getElementById('pageForm').reset();
            document.getElementById('pageAuthor').value=currentUser.name;
            openModal('pageModal');
        }

        function editPage(id){
            const p=pages.find(x=>x.id===id);
            if(p){
                document.getElementById('pageModalTitle').textContent='Edit Page';
                document.getElementById('pageTitleInput').value=p.title;
                document.getElementById('pageContent').value=p.content;
                document.getElementById('pageStatus').value=p.status;
                document.getElementById('pageAuthor').value=p.author;
                openModal('pageModal');
            }
        }

        async function deletePage(id){
            if(confirm('Delete this page?')){
                pages=pages.filter(p=>p.id!==id);
                saveToLocalStorage();
                // await deleteFromFirebase('pages', 'page_' + id);
                loadPages();
                loadDashboard();
                showToast('Page deleted','success');
            }
        }

        document.getElementById('pageForm').addEventListener('submit',async function(e){
            e.preventDefault();
            const newPage = {id:pages.length+1,title:document.getElementById('pageTitleInput').value,content:document.getElementById('pageContent').value,status:document.getElementById('pageStatus').value,author:currentUser.name,date:new Date().toISOString().split('T')[0]};
            pages.push(newPage);
            saveToLocalStorage();
            // Firebase save is optional due to permission issues
            // await saveToFirebase('pages', 'page_' + newPage.id, newPage);
            closeModal('pageModal');
            loadPages();
            loadDashboard();
            showToast('Page created','success');
        });

        function loadPosts(){
            document.getElementById('postsTable').innerHTML=posts.map(p=>`<tr><td>${p.title}</td><td>${p.author}</td><td>${p.category}</td><td><span class="status-badge status-${p.status}">${p.status}</span></td><td>${p.date}</td><td><div class="action-buttons"><button class="btn-icon" onclick="editPost(${p.id})">‚úèÔ∏è</button><button class="btn-icon" onclick="deletePost(${p.id})">üóëÔ∏è</button></div></td></tr>`).join('');
        }

        function openNewPostModal(){
            document.getElementById('postModalTitle').textContent='New Post';
            document.getElementById('postForm').reset();
            openModal('postModal');
        }

        function editPost(id){
            const p=posts.find(x=>x.id===id);
            if(p){
                document.getElementById('postModalTitle').textContent='Edit Post';
                document.getElementById('postTitle').value=p.title;
                document.getElementById('postContent').value=p.content;
                document.getElementById('postCategory').value=p.category;
                document.getElementById('postStatus').value=p.status;
                openModal('postModal');
            }
        }

        async function deletePost(id){
            if(confirm('Delete this post?')){
                posts=posts.filter(p=>p.id!==id);
                saveToLocalStorage();
                // await deleteFromFirebase('posts', 'post_' + id);
                loadPosts();
                loadDashboard();
                showToast('Post deleted','success');
            }
        }

        document.getElementById('postForm').addEventListener('submit',async function(e){
            e.preventDefault();
            const newPost = {id:posts.length+1,title:document.getElementById('postTitle').value,content:document.getElementById('postContent').value,category:document.getElementById('postCategory').value,status:document.getElementById('postStatus').value,author:currentUser.name,date:new Date().toISOString().split('T')[0]};
            posts.push(newPost);
            saveToLocalStorage();
            // await saveToFirebase('posts', 'post_' + newPost.id, newPost);
            closeModal('postModal');
            loadPosts();
            loadDashboard();
            showToast('Post created','success');
        });

        // ==================== ENHANCED MEDIA FUNCTIONS ====================
        
        function updateFileInputAccept(){
            const type=document.getElementById('mediaType').value;
            const input=document.getElementById('mediaFileInput');
            const icon=document.getElementById('uploadIcon');
            if(type==='Image'){input.accept='image/*';icon.textContent='üñºÔ∏è';}
            else if(type==='Video'){input.accept='video/*';icon.textContent='üé•';}
            else{input.accept='.pdf,.doc,.docx,.txt,.xls,.xlsx,.ppt,.pptx';icon.textContent='üìÑ';}
        }

        function handleFileSelect(e){
            const file=e.target.files[0];
            if(!file)return;
            if(file.size>50*1024*1024){showToast('File exceeds 50MB!','error');return;}
            selectedFile=file;
            if(!document.getElementById('mediaName').value){
                document.getElementById('mediaName').value=file.name;
            }
            document.getElementById('uploadButton').disabled=false;
            showFilePreview(file);
        }

        function showFilePreview(file){
            const preview=document.getElementById('filePreview');
            const type=document.getElementById('mediaType').value;
            preview.style.display='block';
            const reader=new FileReader();
            if(type==='Image'){
                reader.onload=function(e){
                    preview.innerHTML=`<h4 style="color:var(--text-primary);margin-bottom:1rem">Image Preview:</h4><img src="${e.target.result}" class="preview-image"><p style="color:var(--text-secondary);margin-top:0.5rem;font-size:0.875rem">${file.name} (${formatFileSize(file.size)})</p>`;
                };
                reader.readAsDataURL(file);
            }else if(type==='Video'){
                reader.onload=function(e){
                    preview.innerHTML=`<h4 style="color:var(--text-primary);margin-bottom:1rem">Video Preview:</h4><video src="${e.target.result}" class="preview-video" controls></video><p style="color:var(--text-secondary);margin-top:0.5rem;font-size:0.875rem">${file.name} (${formatFileSize(file.size)})</p>`;
                };
                reader.readAsDataURL(file);
            }else{
                preview.innerHTML=`<h4 style="color:var(--text-primary);margin-bottom:1rem">File Info:</h4><div class="preview-file-info"><div class="preview-file-icon">üìÑ</div><div class="preview-file-details"><div class="preview-file-name">${file.name}</div><div class="preview-file-size">${formatFileSize(file.size)} ‚Ä¢ ${file.type||'Unknown'}</div></div></div>`;
            }
        }

        function formatFileSize(bytes){
            if(bytes===0)return '0 Bytes';
            const k=1024,sizes=['Bytes','KB','MB','GB'],i=Math.floor(Math.log(bytes)/Math.log(k));
            return Math.round(bytes/Math.pow(k,i)*100)/100+' '+sizes[i];
        }

        const uploadZone=document.getElementById('fileUploadZone');
        uploadZone.addEventListener('dragover',function(e){e.preventDefault();uploadZone.classList.add('dragover');});
        uploadZone.addEventListener('dragleave',function(e){e.preventDefault();uploadZone.classList.remove('dragover');});
        uploadZone.addEventListener('drop',function(e){
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            const files=e.dataTransfer.files;
            if(files.length>0){
                document.getElementById('mediaFileInput').files=files;
                handleFileSelect({target:{files:files}});
            }
        });

        document.getElementById('mediaForm').addEventListener('submit',function(e){
            e.preventDefault();
            if(!selectedFile){showToast('Select a file!','error');return;}
            const reader=new FileReader();
            reader.onload=async function(e){
                const newMedia = {id:media.length+1,name:document.getElementById('mediaName').value||selectedFile.name,type:document.getElementById('mediaType').value,description:document.getElementById('mediaDescription').value,size:formatFileSize(selectedFile.size),date:new Date().toISOString().split('T')[0],dataUrl:e.target.result,fileType:selectedFile.type};
                media.push(newMedia);
                saveToLocalStorage();
                // await saveToFirebase('media', 'media_' + newMedia.id, newMedia);
                closeModal('mediaModal');
                resetMediaForm();
                loadMedia();
                loadDashboard();
                showToast('Media uploaded!','success');
            };
            reader.readAsDataURL(selectedFile);
        });

        function resetMediaForm(){
            document.getElementById('mediaForm').reset();
            document.getElementById('filePreview').style.display='none';
            document.getElementById('uploadButton').disabled=true;
            selectedFile=null;
            updateFileInputAccept();
        }

        function openMediaModal(){
            resetMediaForm();
            openModal('mediaModal');
        }

        function loadMedia(){
            let filtered=currentMediaFilter==='all'?media:media.filter(m=>m.type===currentMediaFilter);
            if(filtered.length===0){
                document.getElementById('mediaGrid').innerHTML='<p class="loading">No media files found</p>';
                return;
            }
            document.getElementById('mediaGrid').innerHTML=filtered.map(f=>{
                let thumb=f.type==='Image'&&f.dataUrl?`<img src="${f.dataUrl}" alt="${f.name}">`:f.type==='Video'&&f.dataUrl?`<video src="${f.dataUrl}"></video>`:f.type==='Image'?'üñºÔ∏è':f.type==='Video'?'üé•':'üìÑ';
                return `<div class="media-card"><div class="media-thumbnail">${thumb}</div><div class="media-info"><div class="media-name">${f.name}</div><div class="media-meta"><span>${f.type}</span><span>${f.size}</span></div><div class="media-description">${f.description||'No description'}</div><div class="media-meta"><span>${f.date}</span></div><div class="media-actions"><button class="btn-view" onclick="viewMedia(${f.id})">üëÅÔ∏è View</button><button class="btn-delete" onclick="deleteMedia(${f.id})">üóëÔ∏è</button></div></div></div>`;
            }).join('');
        }

        function filterMediaByType(type,e){
            currentMediaFilter=type;
            document.querySelectorAll('.media-type-tab').forEach(t=>t.classList.remove('active'));
            e.target.classList.add('active');
            loadMedia();
        }

        function viewMedia(id){
            const f=media.find(m=>m.id===id);
            if(!f)return;
            const c=document.getElementById('previewContainer');
            let content='';
            if(f.type==='Image'&&f.dataUrl){
                content=`<img src="${f.dataUrl}" alt="${f.name}">`;
            }else if(f.type==='Video'&&f.dataUrl){
                content=`<video src="${f.dataUrl}" controls></video>`;
            }else if(f.type==='Document'&&f.dataUrl){
                if(f.fileType==='application/pdf'){
                    content=`<iframe src="${f.dataUrl}"></iframe>`;
                }else{
                    content=`<div style="background:var(--bg-secondary);padding:3rem;border-radius:12px;text-align:center"><div style="font-size:5rem;margin-bottom:1rem">üìÑ</div><h2 style="color:var(--text-primary);margin-bottom:1rem">${f.name}</h2><p style="color:var(--text-secondary);margin-bottom:2rem">${f.size} ‚Ä¢ ${f.date}</p><p style="color:var(--text-secondary)">${f.description||'No description'}</p><a href="${f.dataUrl}" download="${f.name}" class="btn btn-primary" style="margin-top:2rem;display:inline-flex"><span>üíæ</span> Download</a></div>`;
                }
            }else{
                content=`<div style="background:var(--bg-secondary);padding:3rem;border-radius:12px;text-align:center"><div style="font-size:5rem;margin-bottom:1rem">üìÅ</div><h2 style="color:var(--text-primary);margin-bottom:1rem">${f.name}</h2><p style="color:var(--text-secondary)">${f.size} ‚Ä¢ ${f.date}</p><p style="color:var(--text-secondary);margin-top:1rem">${f.description||'No description'}</p></div>`;
            }
            c.innerHTML=content;
            document.getElementById('previewModal').classList.add('active');
        }

        function closePreviewModal(){
            document.getElementById('previewModal').classList.remove('active');
            document.getElementById('previewContainer').innerHTML='';
        }

        async function deleteMedia(id){
            if(confirm('Delete this media file?')){
                media=media.filter(m=>m.id!==id);
                saveToLocalStorage();
                // await deleteFromFirebase('media', 'media_' + id);
                loadMedia();
                loadDashboard();
                showToast('Media deleted','success');
            }
        }

        document.getElementById('previewModal').addEventListener('click',function(e){
            if(e.target===this)closePreviewModal();
        });

        // Users Management
        function loadUsers(){
            document.getElementById('usersTable').innerHTML=users.map(u=>`<tr><td>${u.name}</td><td>${u.email}</td><td>${u.role}</td><td><span class="status-badge ${u.status==='Active'?'status-published':'status-draft'}">${u.status}</span></td><td>${u.joined}</td><td><div class="action-buttons"><button class="btn-icon" onclick="deleteUser(${u.id})">üóëÔ∏è</button></div></td></tr>`).join('');
        }

        function openNewUserModal(){
            document.getElementById('userForm').reset();
            openModal('userModal');
        }

        async function deleteUser(id){
            if(id===currentUser.id){alert('Cannot delete your own account!');return;}
            if(confirm('Delete this user?')){
                users=users.filter(u=>u.id!==id);
                saveToLocalStorage();
                // await deleteFromFirebase('users', 'user_' + id);
                loadUsers();
                loadDashboard();
                showToast('User deleted','success');
            }
        }

        document.getElementById('userForm').addEventListener('submit',async function(e){
            e.preventDefault();
            const newUser = {id:users.length+1,username:document.getElementById('newUserEmail').value.split('@')[0],password:'password123',name:document.getElementById('newUserName').value,email:document.getElementById('newUserEmail').value,role:document.getElementById('newUserRole').value,status:document.getElementById('newUserStatus').value,joined:new Date().toISOString().split('T')[0]};
            users.push(newUser);
            saveToLocalStorage();
            // await saveToFirebase('users', 'user_' + newUser.id, newUser);
            closeModal('userModal');
            loadUsers();
            loadDashboard();
            showToast('User added','success');
        });

        document.getElementById('settingsForm').addEventListener('submit',function(e){
            e.preventDefault();
            showToast('Settings saved','success');
        });

        // Modal Controls
        function openModal(id){document.getElementById(id).classList.add('active');}
        function closeModal(id){document.getElementById(id).classList.remove('active');}

        // Utilities
        function showAlert(id,msg,type){
            document.getElementById(id).innerHTML=`<div class="alert alert-${type}"><span>${type==='success'?'‚úì':'‚úï'}</span>${msg}</div>`;
            setTimeout(()=>document.getElementById(id).innerHTML='',3000);
        }

        function showToast(msg,type){
            const t=document.createElement('div');
            t.className=`toast ${type}`;
            t.innerHTML=`<span>${type==='success'?'‚úì':'‚úï'}</span>${msg}`;
            document.body.appendChild(t);
            setTimeout(()=>{
                t.style.animation='slideOutRight 0.4s ease';
                setTimeout(()=>t.remove(),400);
            },3000);
        }

        document.getElementById('logoutBtn').addEventListener('click',function(){
            if(confirm('Logout?')){
                currentUser=null;
                document.getElementById('dashboard').classList.remove('active');
                document.getElementById('loginPage').style.display='flex';
                document.getElementById('loginForm').reset();
            }
        });

        document.getElementById('menuToggle').addEventListener('click',function(){
            document.getElementById('sidebar').classList.toggle('mobile-active');
        });

        document.addEventListener('click',function(e){
            const sidebar=document.getElementById('sidebar');
            const toggle=document.getElementById('menuToggle');
            if(!sidebar.contains(e.target)&&!toggle.contains(e.target)){
                sidebar.classList.remove('mobile-active');
            }
        });

        initializeSampleData();
    </script>
</body>
</html>
